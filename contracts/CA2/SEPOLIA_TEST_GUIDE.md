# RecipeNFT ERC-4907 Sepolia 测试指南

## 🎯 测试目标
在Sepolia测试网上测试Recipe NFT的ERC-4907授权功能，实现将Recipe NFT授权给ID NFT（或其他地址）的临时访问权限管理。

## 📋 前置要求

### 1. 环境准备
- Node.js 和 npm 已安装
- MetaMask 钱包已安装
- 有Sepolia测试网ETH（可以从水龙头获取）

### 2. 获取Sepolia测试币
- [Sepolia Faucet](https://sepoliafaucet.com/)
- [Alchemy Sepolia Faucet](https://sepoliafaucet.com/)

### 3. 配置环境变量
创建 `.env` 文件：
```bash
# 你的私钥（用于部署合约）
PRIVATE_KEY=your_private_key_here

# Sepolia RPC URL (推荐使用 Alchemy 或 Infura)
SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY

# Etherscan API Key (用于验证合约)
ETHERSCAN_API_KEY=your_etherscan_api_key
```

## 🚀 部署步骤

### 1. 安装依赖
```bash
npm install
```

### 2. 编译合约
```bash
npx hardhat compile
```

### 3. 部署到Sepolia
```bash
npx hardhat run scripts/deploy-sepolia.js --network sepolia
```

### 4. 记录合约地址
部署完成后，记录输出的合约地址，例如：
```
📍 合约地址: 0x1234567890123456789012345678901234567890
```

## 🧪 前端测试步骤

### 1. 启动前端测试页面
```bash
# 方法1: 使用Python启动本地服务器
python3 -m http.server 8080

# 方法2: 使用Node.js
npx http-server -p 8080

# 方法3: 直接在浏览器中打开
# 双击 test-frontend.html 文件
```

### 2. 访问测试页面
打开浏览器访问：`http://localhost:8080/test-frontend.html`

### 3. 连接钱包
1. 点击"连接钱包"按钮
2. 确保MetaMask切换到Sepolia网络
3. 确认连接

### 4. 加载合约
1. 在"合约配置"区域输入部署的合约地址
2. 点击"加载合约"

## 🔐 ERC-4907 授权测试流程

### 测试场景1: 基本授权功能

#### 步骤1: 铸造Recipe NFT
1. 在"铸造Recipe NFT"区域输入IPFS URI
   ```
   ipfs://QmTestRecipeHash123456789
   ```
2. 点击"铸造NFT"
3. 在MetaMask中确认交易

#### 步骤2: 设置授权用户
1. 在"ERC-4907 授权管理"区域：
   - Recipe NFT Token ID: `1`
   - 授权用户地址: 输入另一个钱包地址（或ID NFT地址）
   - 授权过期时间: `3600` (1小时)
2. 点击"设置授权用户"
3. 在MetaMask中确认交易

#### 步骤3: 查询授权状态
1. 在"授权状态查询"区域输入Token ID: `1`
2. 点击"查询授权用户"
3. 查看授权信息

#### 步骤4: 检查访问权限
1. 切换到被授权的钱包地址
2. 点击"检查访问权限"
3. 验证是否有访问权限

### 测试场景2: 价格和销售管理

#### 步骤1: 设置价格
1. 在"价格和销售管理"区域：
   - Token ID: `1`
   - 授权价格: `1000000000000000000` (1 USDT)
2. 点击"设置价格"

#### 步骤2: 设置为可授权
1. Token ID: `1`
2. 点击"设置为可授权"

#### 步骤3: 查询可授权的NFT
1. 点击"查询可授权的NFT"
2. 查看结果

### 测试场景3: 授权过期测试

#### 步骤1: 设置短期授权
1. 设置授权过期时间为 `60` 秒（1分钟）
2. 设置授权用户
3. 立即检查访问权限（应该为true）

#### 步骤2: 等待过期
1. 等待1分钟
2. 再次检查访问权限（应该为false）

### 测试场景4: 移除授权

#### 步骤1: 移除授权用户
1. 输入Token ID
2. 点击"移除授权用户"
3. 确认交易

#### 步骤2: 验证移除
1. 查询授权用户信息
2. 应该显示"该NFT没有授权用户"

## 📊 测试检查清单

- [ ] 钱包连接成功
- [ ] 合约加载成功
- [ ] Recipe NFT铸造成功
- [ ] 授权用户设置成功
- [ ] 授权状态查询正确
- [ ] 访问权限检查正确
- [ ] 价格设置成功
- [ ] 销售状态设置成功
- [ ] 授权过期功能正常
- [ ] 授权移除功能正常
- [ ] 查询功能正常

## 🔍 常见问题

### 1. 网络错误
**问题**: 无法连接到Sepolia网络
**解决**: 
- 确保MetaMask切换到Sepolia网络
- 检查RPC URL是否正确
- 确保有足够的Sepolia ETH

### 2. 合约加载失败
**问题**: 合约地址无效或合约不存在
**解决**:
- 检查合约地址是否正确
- 确保合约已成功部署
- 检查网络是否匹配

### 3. 交易失败
**问题**: 交易被拒绝或失败
**解决**:
- 检查账户余额是否足够
- 确保有足够的gas费用
- 检查合约状态（是否激活）

### 4. 授权失败
**问题**: 无法设置授权用户
**解决**:
- 确保你是NFT的拥有者
- 检查NFT是否设置为可授权状态
- 确保过期时间在未来

## 📈 测试结果记录

| 测试项目 | 状态 | 备注 |
|---------|------|------|
| 合约部署 | ✅ | 合约地址: `0x...` |
| 钱包连接 | ✅ | 地址: `0x...` |
| NFT铸造 | ✅ | Token ID: 1 |
| 授权设置 | ✅ | 用户: `0x...` |
| 权限检查 | ✅ | 访问权限正常 |
| 过期测试 | ✅ | 过期后权限失效 |
| 移除授权 | ✅ | 授权成功移除 |

## 🎉 测试完成

完成所有测试后，你已经成功验证了RecipeNFT合约的ERC-4907功能：

1. ✅ **临时授权**: 可以将Recipe NFT授权给其他地址
2. ✅ **时间控制**: 授权有过期时间，自动失效
3. ✅ **权限管理**: 可以查询和检查访问权限
4. ✅ **价格设置**: 可以为授权设置价格
5. ✅ **状态管理**: 可以控制NFT是否可授权

这个测试验证了你的Recipe NFT系统可以完美支持鸡尾酒配方的临时授权访问功能！ 